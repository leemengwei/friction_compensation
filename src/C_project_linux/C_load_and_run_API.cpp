#define num_of_cols 25
#define num_of_rows 6
#define LOOP 10000
#define TIME_INTERVAL 1   //ms
#define WARM_UP_TIME_SINGLE 100
#define WARM_UP_TIME_MULTI 100
#define REFRESH_CACHE true

#include <iostream>
#include <memory>
#include <sys/time.h>
#include <torch/script.h>
#include <pthread.h>
#include <unistd.h>
#include <string.h>
#include "ATen/Parallel.h"
#include <omp.h>
using namespace std;

struct thread_data{
  int id;
  bool use_cuda;
  torch::jit::script::Module model;
  float flat[num_of_rows][num_of_cols];
  float X_mean[num_of_rows][num_of_cols];
  float X_standard[num_of_rows][num_of_cols];
  float Y_mean;
  float Y_standard;
  std::vector<float> final_out;
  };


//Function to preprocess input data
std::vector<torch::jit::IValue> preprocessing(float flat[][num_of_cols], float X_mean[][num_of_cols], float X_standard[][num_of_cols], float preprocessed_data[][num_of_cols], bool use_cuda) {
  //flat=((flat-mean)/standard);
  for (int i = 0; i < num_of_rows; i++) {
      for (int j = 0; j < num_of_cols; j++) {
          preprocessed_data[i][j] = (flat[i][j] - X_mean[i][j]) / X_standard[i][j];
      }
  }
  //Float to tensor
  at::Tensor data = torch::from_blob(preprocessed_data, {num_of_rows,num_of_cols}, torch::kFloat);
  data = data.toType(torch::kFloat);
  if (use_cuda){
    data=data.to(at::kCUDA);
   }
  std::vector<torch::jit::IValue> inputs;
  inputs.push_back(data);
  return inputs;
}

//Function to postprocess output data
std::vector<float> postprocessing(at::Tensor &output, float Y_mean, float Y_standard) {
  //Tensor to float
  at::Tensor cpu_output;
  cpu_output = output.to(at::kCPU);
  std::vector<float> out(cpu_output.data<float>(), cpu_output.data<float>() + cpu_output.numel());
  //flat=flat*standard+mean
  for (int i = 0; i < num_of_rows; i++) {
      out[i] = out[i]*Y_standard+Y_mean;
  }
  return out;
}

//Function to load model
torch::jit::script::Module get_model(const char* model_path, bool use_cuda) {
  torch::jit::script::Module module;
  try {
    module = torch::jit::load(model_path);
    ;
  }
  catch (const c10::Error& e) {
    std::cerr << "Error loading the model\n";
    exit(-1);
  }
  cout<<"Model loaded:"<<model_path<<endl;
  if (use_cuda){
    module.to(at::kCUDA);
  }
  return module;
}

//Core to run
std::vector<float> predict(float flat[][num_of_cols], float X_mean[][num_of_cols], float X_standard[][num_of_cols], bool use_cuda, torch::jit::script::Module model, float Y_mean, float Y_standard, std::vector<float> final_out) {
  at::set_num_threads(1);
  float preprocessed_data[num_of_rows][num_of_cols];
  std::vector<torch::jit::IValue> inputs;
  at::Tensor output;
  //Preprocess data:
  inputs = preprocessing(flat, X_mean, X_standard, preprocessed_data, use_cuda);
  //Forward:
  //timeval tic, toc;
  //double tictoc;
  //gettimeofday(&tic,0);
  output = model.forward(inputs).toTensor();  
  //gettimeofday(&toc,0);
  //tictoc = 1000000*(toc.tv_sec-tic.tv_sec)+toc.tv_usec-tic.tv_usec; //us
  //tictoc /= 1000; //ms
  //std::cout<<"Time predict"<<tictoc<<"ms"<<endl;
  //Postprocess data:
  final_out = postprocessing(output, Y_mean, Y_standard);
  return final_out;
}

//Core to dry-run
std::vector<float> predict_dry_run(float flat[][num_of_cols], float X_mean[][num_of_cols], float X_standard[][num_of_cols], bool use_cuda, torch::jit::script::Module model, float Y_mean, float Y_standard, std::vector<float> final_out) {
  usleep(5*1000);//ms
  ;
  return final_out;
}

// 线程的运行函数
void* single_start(void*threadarg)
{
  struct thread_data *my_data;
  my_data = (struct thread_data *) threadarg;
  for (int loop=0; loop<LOOP; loop++){
    if(REFRESH_CACHE){
      for(int row=0;row<num_of_rows;row++){
        for(int col=0;col<num_of_cols;col++){
          my_data->flat[row][col] = loop;
        }
      }
    }
    //Warm up? So far, each thread is started only once and loop within, thus warming up itself. Yet this comsumption was undesirably calculated.
    my_data->final_out = predict(my_data->flat, my_data->X_mean, my_data->X_standard, my_data->use_cuda, my_data->model, my_data->Y_mean, my_data->Y_standard, my_data->final_out);
  usleep(TIME_INTERVAL*1000);
  }
  //pthread_exit(NULL);
}

int main(int argc, const char* argv[]) {
  //omp_set_num_threads(1);
  //Config:
  bool use_cuda=(argc>1)?true:false;
  if (use_cuda){std::cout<<"USING GPU"<<std::endl;}
  else{std::cout<<"USING CPU"<<std::endl;}
  std::cout<<"Warmed up for (s)"<<WARM_UP_TIME_SINGLE<<" and (m)"<<WARM_UP_TIME_MULTI<<" times. Refresh cache: "<<REFRESH_CACHE<<endl;

  //Timers:
  timeval tic, toc;
  double tictoc;

  std::cout<<"\nNow on single thread"<<endl;
  //Get model:
  const char* model_path="../models/NN_weights_all_C.pt";
  torch::jit::script::Module model=get_model(model_path, use_cuda);

  //Get data:
  float flat[num_of_rows][num_of_cols]={
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      };
  float X_mean[num_of_rows][num_of_cols] = {
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
   };
   float X_standard[num_of_rows][num_of_cols] = {
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
   };
  float Y_mean = -0.0014823869995695225;
  float Y_standard = 0.10306605601654062;
  std::vector<float> final_out;

  //Warm up:
  for (int x=0;x<WARM_UP_TIME_SINGLE;x++){
  final_out = predict(flat, X_mean, X_standard, use_cuda, model, Y_mean, Y_standard, final_out);
  }
  gettimeofday(&tic,0);
  for (int loop=0;loop<LOOP;loop++){
    if(REFRESH_CACHE){
      for(int row=0;row<num_of_rows;row++){
        for(int col=0;col<num_of_cols;col++){
          flat[row][col] = loop;
        }
      }
    }
    //Forward run:
    final_out = predict(flat, X_mean, X_standard, use_cuda, model, Y_mean, Y_standard, final_out);
    usleep(TIME_INTERVAL*1000);
  }
  gettimeofday(&toc,0);
  tictoc = 1000000*(toc.tv_sec-tic.tv_sec)+toc.tv_usec-tic.tv_usec; //us
  tictoc /= 1000; //ms
  std::cout<<"Time used over LOOPs("<<LOOP<<"): "<<tictoc/LOOP<<"ms"<<endl;

  //Report:
  for (int i=0;i<num_of_rows;i++){
    std::cout<<final_out[i]<<" ";
  }


  std::cout<<"\n\n\nNow on multi thread"<<endl;
  //Multi thread----------------------------:
  float flat0[num_of_rows][num_of_cols]={
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      };
  float flat1[num_of_rows][num_of_cols]={
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      };
  float flat2[num_of_rows][num_of_cols]={
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      };
  float flat3[num_of_rows][num_of_cols]={
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      };
  float flat4[num_of_rows][num_of_cols]={
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      };
  float flat5[num_of_rows][num_of_cols]={
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0,
      };
  float X_mean0[num_of_rows][num_of_cols] = {
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
   };
  float X_mean1[num_of_rows][num_of_cols] = {
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
   };
  float X_mean2[num_of_rows][num_of_cols] = {
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
   };
  float X_mean3[num_of_rows][num_of_cols] = {
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
   };
  float X_mean4[num_of_rows][num_of_cols] = {
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
   };
  float X_mean5[num_of_rows][num_of_cols] = {
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
        2.51065213e-04, 2.26194300e+02, -3.87426864e-03, -3.87426074e-03, 2.22841566e-04, 3.23421159e+01, -3.59547080e-01, -3.30278722e-03, -6.44383032e-04, 8.86972255e+01, 8.88570940e-02, 2.07215009e-03, -5.10639766e-02, -1.07646179e+00, -5.16060366e-03, -1.96551706e-05, -3.95824362e-04, -4.44822192e-01, 1.01560208e-03, -7.17683819e-05, 1.0, 8.42130893e-06, 1.0, 1.0, 1.0,
   };
  float X_standard0[num_of_rows][num_of_cols] = {
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
   };
 float X_standard1[num_of_rows][num_of_cols] = {
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
   };
 float X_standard2[num_of_rows][num_of_cols] = {
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
   };
 float X_standard3[num_of_rows][num_of_cols] = {
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
   };
 float X_standard4[num_of_rows][num_of_cols] = {
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
   };
 float X_standard5[num_of_rows][num_of_cols] = {
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
        1.49259451e-02, 3.22330006e-03, 1.96332955e-02, 1.96332663e-02, 8.86414915e-03, 1.26311744e+02, 1.40872237e+00, 1.98642367e-02, 2.82137393e-02, 1.65190416e+02, 3.03534892e-01, 1.14498188e-02, 2.04909340e+02, 1.20522046e+02, 5.97290116e-02, 4.98756114e-02, 1.37543738e-01, 1.08568109e+02, 1.89032465e-02, 6.36430634e-04, 1.0, 1.48271675e-04, 1.0, 1.0, 1.0,
   };
  float Y_mean0 = -0.0014823869995695225;
  float Y_mean1 = -0.0014823869995695225;
  float Y_mean2 = -0.0014823869995695225;
  float Y_mean3 = -0.0014823869995695225;
  float Y_mean4 = -0.0014823869995695225;
  float Y_mean5 = -0.0014823869995695225;
  float Y_standard0 = 0.10306605601654062;
  float Y_standard1 = 0.10306605601654062;
  float Y_standard2 = 0.10306605601654062;
  float Y_standard3 = 0.10306605601654062;
  float Y_standard4 = 0.10306605601654062;
  float Y_standard5 = 0.10306605601654062;
  const char* model_path0="../models/NN_weights_all_C0.pt";
  const char* model_path1="../models/NN_weights_all_C1.pt";
  const char* model_path2="../models/NN_weights_all_C2.pt";
  const char* model_path3="../models/NN_weights_all_C3.pt";
  const char* model_path4="../models/NN_weights_all_C4.pt";
  const char* model_path5="../models/NN_weights_all_C5.pt";
  std::vector<float> final_out0;
  std::vector<float> final_out1;
  std::vector<float> final_out2;
  std::vector<float> final_out3;
  std::vector<float> final_out4;
  std::vector<float> final_out5;

  //Form td data struct
  struct thread_data td[6];
  td[0].id = 0;
  td[1].id = 1;
  td[2].id = 2;
  td[3].id = 3;
  td[4].id = 4;
  td[5].id = 5;
  td[0].use_cuda = use_cuda;
  td[1].use_cuda = use_cuda;
  td[2].use_cuda = use_cuda;
  td[3].use_cuda = use_cuda;
  td[4].use_cuda = use_cuda;
  td[5].use_cuda = use_cuda;
  td[0].model = get_model(model_path0, use_cuda);
  td[1].model = get_model(model_path1, use_cuda);
  td[2].model = get_model(model_path2, use_cuda);
  td[3].model = get_model(model_path3, use_cuda);
  td[4].model = get_model(model_path4, use_cuda);
  td[5].model = get_model(model_path5, use_cuda);
  td[0].Y_mean = Y_mean0;
  td[1].Y_mean = Y_mean1;
  td[2].Y_mean = Y_mean2;
  td[3].Y_mean = Y_mean3;
  td[4].Y_mean = Y_mean4;
  td[5].Y_mean = Y_mean5;
  td[0].Y_standard = Y_standard0;
  td[1].Y_standard = Y_standard1;
  td[2].Y_standard = Y_standard2;
  td[3].Y_standard = Y_standard3;
  td[4].Y_standard = Y_standard4;
  td[5].Y_standard = Y_standard5;
  memcpy(td[0].X_mean, X_mean0, sizeof(X_mean0));
  memcpy(td[1].X_mean, X_mean1, sizeof(X_mean1));
  memcpy(td[2].X_mean, X_mean2, sizeof(X_mean2));
  memcpy(td[3].X_mean, X_mean3, sizeof(X_mean3));
  memcpy(td[4].X_mean, X_mean4, sizeof(X_mean4));
  memcpy(td[5].X_mean, X_mean5, sizeof(X_mean5));
  memcpy(td[0].X_standard, X_standard0, sizeof(X_standard0));
  memcpy(td[1].X_standard, X_standard1, sizeof(X_standard1));
  memcpy(td[2].X_standard, X_standard2, sizeof(X_standard2));
  memcpy(td[3].X_standard, X_standard3, sizeof(X_standard3));
  memcpy(td[4].X_standard, X_standard4, sizeof(X_standard4));
  memcpy(td[5].X_standard, X_standard5, sizeof(X_standard5));
  memcpy(td[0].flat, flat0, sizeof(flat0));
  memcpy(td[1].flat, flat1, sizeof(flat1));
  memcpy(td[2].flat, flat2, sizeof(flat2));
  memcpy(td[3].flat, flat3, sizeof(flat3));
  memcpy(td[4].flat, flat4, sizeof(flat4));
  memcpy(td[5].flat, flat5, sizeof(flat5));
  td[0].final_out = final_out0;
  td[1].final_out = final_out1;
  td[2].final_out = final_out2;
  td[3].final_out = final_out3;
  td[4].final_out = final_out4;
  td[5].final_out = final_out5;

  //Starting threads:
  pthread_t t[6];
  float running_t = 0.0;
  //Warm up for each thread model:
  //for (int x=0;x<WARM_UP_TIME_MULTI;x++){
  //  for (int i=0;i<=5;i++){
  //    td[i].final_out = predict(td[i].flat, td[i].X_mean, td[i].X_standard, td[i].use_cuda, td[i].model, td[i].Y_mean, td[i].Y_standard, td[i].final_out);
  //  }
  //}
  gettimeofday(&tic,0);
  //创建的线程id，线程属性，调用的函数，传入的参数
  pthread_create(&t[0], NULL, single_start, (void *)&td[0]);
  pthread_create(&t[1], NULL, single_start, (void *)&td[1]);
  pthread_create(&t[2], NULL, single_start, (void *)&td[2]);
  pthread_create(&t[3], NULL, single_start, (void *)&td[3]);
  pthread_create(&t[4], NULL, single_start, (void *)&td[4]);
  pthread_create(&t[5], NULL, single_start, (void *)&td[5]);
  //Join together
  pthread_join(t[0],NULL);
  pthread_join(t[1],NULL);
  pthread_join(t[2],NULL);
  pthread_join(t[3],NULL);
  pthread_join(t[4],NULL);
  pthread_join(t[5],NULL);
  //等线程退出后，进程才结束 否则强制
  //pthread_exit(NULL);
  //running_t += tictoc;
  gettimeofday(&toc,0);
  tictoc = 1000000*(toc.tv_sec-tic.tv_sec)+toc.tv_usec-tic.tv_usec; //us
  tictoc /= 1000; //ms
  std::cout<<"\nMulti thread time used over each LOOP("<<LOOP<<"): "<<tictoc/LOOP<<"ms"<<std::endl;

  //Report:
  for (int i=0;i<=5;i++){
    for (int j=0;j<num_of_rows;j++){
      std::cout<<td[i].final_out[j]<<" ";
    }
    std::cout<<endl;
  }


  std::cout << "\nTHE END" << '\n';
  
}

